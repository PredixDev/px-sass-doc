<!--
    Relative paths assume component is being run from inside an app or another component, where dependencies are flat
    siblings. When this component is run from its own repo (e.g. tests, examples), we assume the server is started with
    'gulp serve' (or similar server setup) to enable correct finding of bower dependencies for local runs.
-->
<link rel="import" href="../polymer/polymer.html"/>

<link rel="import" href="css/px-sass-doc-viewer-styles.html">
<link rel="import" href="../px-clipboard/px-clipboard.html">
<link rel="import" href="../px-dropdown/px-dropdown.html"/>


<!--
Element providing documentation for a requested Predix UI Sass component (design library).

##### Usage

      <px-sass-doc-viewer
        library-name="px-toggle-design"
        layer="objects"
        base-name="toggle"
        inuit-flags='["$inuit-enable-toggle--small","$inuit-enable-toggle--large","$inuit-enable-toggle--huge"]'
        usage-html='["<input id=\"toggle1\" class=\"toggle__input\" type=\"checkbox\">","<label for=\"toggle1\" class=\"toggle__label\"></label>"]'
        style-variables='["$inuit-toggle-color","$inuit-toggle-background","$inuit-toggle-border","$inuit-toggle-switch","$inuit-toggle-switch-border","$inuit-toggle-switch-shadow","$inuit-toggle-background--on","$inuit-toggle-border--on"]'
        dependencies='["https://github.com/PredixDev/px-colors-design","https://github.com/PredixDev/px-defaults-design","https://github.com/PredixDev/px-helpers-design"]'>
      </px-sass-doc-viewer>

@element px-sass-doc-viewer
@blurb Element providing documentation for a requested Predix UI Sass component (design library).
@homepage index.html
@demo index.html
-->

<dom-module id="px-sass-doc-viewer">
  <template>
    <style include="px-sass-doc-viewer-styles"></style>

    <div style="position: relative;" class="u-pb++ flex flex--col">
          <section>
            <div class="mega-demo flex u-ph++ u-pb++">
              <div class="properties u-ph+ u-pb+ u-mt+">
              <p class="epsilon">Style Options</p>
              <template is="dom-repeat" items="{{styleOptionsArray}}">
                  <template is="dom-if" if="{{_isEqual(item.type,'dropdown')}}">
                    <div class="u-mb-">{{item.label}}:
                      <div style="width: 100%;">
                        <px-dropdown id="{{item.id}}" display-value="{{item.selectedValue}}" value="{{item.selectedValue}}">
                          <px-dropdown-content
                            items="{{item.dropdownItems}}">
                          </px-dropdown-content>
                        </px-dropdown>
                      </div>
                    </div>
                  </template>
                  <template is="dom-if" if="{{_isEqual(item.type,'boolean')}}">
                    <div class="flex u-mb-">
                      <input id="{{item.id}}" class="toggle__input toggle__input--small" type="checkbox" checked="{{item.selectedValue::change}}">
                      <label for$="{{item.id}}" class="toggle__label toggle__label--small"></label>
                      <div class="u-ml-">{{item.label}}</div>
                    </div>
                  </template>
              </template>
            </div>

            <div class="demoContainer u-mt+">
                <div class="flex flex--col">
                  <div class="demo u-p+">
                    <!-- <div class="u-mb">Toggle size is <strong>{{dropdown}}</strong></div> -->
                    <div id="demoCode" class="flex u-mb-">
                      <!-- <div class="u-ml-">Toggle 'checked' value is {{togglecheck}}</div> -->
                      <content ></content>
                    </div>
                    <h4>Import:</h4>
                    <px-clipboard copy-from="#import">
                      <figure class="code u-mr-">
                        <code id="import">
                          {{_importCode}}
                        </code>
                      </figure>
                    </px-clipboard>
                    <h4>Usage:</h4>
                    <px-clipboard copy-from="#usageDemo">
                      <figure class="code u-mr-">
                        <code id="usageDemo">
                        </code>
                      </figure>
                    </px-clipboard>
                </div>
              </div>
            </div>
          </div>
          <div class="apiContainer">
            <div class="flex flex--col api u-mt++">
              <div class="componentHeader">Installation</div>
              <p>Install via command line:</p>
              <px-clipboard copy-from="#install">
                <figure class="code u-mr-">
                  <code id="install">
                    bower install --save {{libraryName}}
                  </code>
                </figure>
              </px-clipboard>

              <div class="componentHeader">Import</div>
                <template is="dom-if" if="{{inuitFlags}}">
                  <p>The following flags are available and, if necessary, should be set to true <strong>prior to the import</strong> statement below.</p>
                  <px-clipboard copy-from="#enable">
                    <figure class="code u-mr-">
                      <code id="enable">
                        <template is="dom-repeat" items="{{inuitFlags}}">
                          {{item}} : true;<br/>
                        </template>
                      </code>
                    </figure>
                  </px-clipboard>
                </template>

                  <p>Include the required import below in your Sass file in the <strong>{{layer}}</strong> layer: <a href="https://github.com/PredixDev/px-getting-started#import-order" target="_blank"><iron-icon icon="fa:fa-question-circle" class="u-mh--"></iron-icon>What's this?</a></p>
                  <px-clipboard copy-from="#import2">
                    <figure class="code u-mr-">
                      <code id="import2">
                        {{_importCode}}
                      </code>
                    </figure>
                  </px-clipboard>

                  <div class="componentHeader">Usage</div>
                  <p>Include the following HTML in your main application to use the element:</p>
                  <px-clipboard copy-from="#usage2">
                    <figure class="code u-mr-">
                      <code id="usage2">
                        <template is="dom-repeat" items="{{usageHtml}}">
                          {{item}} <br/>
                        </template>
                      </code>
                    </figure>
                  </px-clipboard>

                  <template is="dom-if" if="{{styleVariables}}">
                    <div class="componentHeader">Customization</div>
                    <p>The following variables are available to customize the style of this element:</p>
                    <px-clipboard copy-from="#customize">
                      <figure class="code u-mr-">
                        <code id="customize">
                          <template is="dom-repeat" items="{{styleVariables}}">
                            {{item}} <br/>
                          </template>
                        </code>
                      </figure>
                    </px-clipboard>
                  </template>

                  <template is="dom-if" if="{{dependencies}}">
                    <div class="componentHeader">Dependencies</div>
                    <p>This module depends on the following modules (automatically included with Bower install):
                      <ul>
                        <template is="dom-repeat" items="{{dependencies}}">
                          <li><a href="{{item}}" target="_blank">{{item}}</a></li>
                        </template>
                      </ul>
                    </p>
                  </template>

            </div>
          </div>
        </section>
      </div>



  </template>
</dom-module>

<script>
  Polymer({

    is: 'px-sass-doc-viewer',

    /**
     * Properties block, expose attribute values to the DOM via 'notify'
     *
     * @property properties
     * @type Object
     */
    properties: {
      /**
      * Name of the overall sass repository.
      *
      * @property libraryName
      * @type String
      **/
      libraryName: {
        type: String,
        value: ''
      },
      /**
      * Inuit flags that are used to enable features and functionality, represented as an array of strings, which will display with line breaks between each.
      *
      * @property inuitFlags
      * @type Array
      */
      inuitFlags: {
        type: Array,
        value: function() { return []; }
      },
      /**
      *  ITCSS layer that this component belongs in, e.g. generic, objects, trumps, etc.
      *
      * @property layer
      * @type String
      */
      layer: {
        type: String,
        value: ''
      },
      /**
      * Base name of the component in the file path, e.g. _objects.BASENAME.scss.
      *
      * @property baseName
      * @type String
      */
      baseName: {
        type: String,
        value: ''
      },
      /**
      * The HTML code snippet to actually use the component, represented as an array of strings. A newline will appear between each string in the array. Include an empty string to result in an extra line break.
      *
      * @property usageHtml
      * @type Array
      */
      usageHtml: {
        type: Array,
        value: function() { return []; }
      },
      /**
      * The SASS variables available for customizing the appearance of the component, represented as an array of strings, which will display with line breaks between each.
      *
      * @property styleVariables
      * @type Array
      */
      styleVariables: {
        type: Array,
        value: function() { return []; }
      },
      /**
      * Any dependencies that exist for this component, represented as an array of strings, which will display in a list. Each string item should be the fully qualified URL of the repo.
      *
      * @property dependencies
      * @type Array
      */
      dependencies: {
        type: Array,
        value: function() { return [];}
      },
      /**
      * Array of objects representing the options to populate on the left side of the mega demo.
      * Each object should contain:
      * - label (to place above or next to the option)
      * - type ("dropdown" or "boolean")
      * - id (for the selector)
      * - dropdownItems (only applies for type dropdown)
      * - selectedValue (only applies for type dropdown)
      *
      * @property styleOptionsArray
      * @type Array
      */
      styleOptionsArray: {
        type: Array,
        value: function() { return []; }
      },
      /**
      * Composed string that represents the import statement of the sass component.
      *
      * @property _importCode
      * @type String
      */
      _importCode: {
        type: String,
        computed: '_calculateImportCode(libraryName,layer,baseName)'
      },
      /**
      * Represents the options that are selected at the time. Used by external components to update themselves based on what options are selected.
      *
      * @property selectedOptions
      * @type Object
      */
      selectedOptions: {
        type: Object,
        value: function() { return {}; }
      }
    },
    observers: ['_updateSelectedOptions(styleOptionsArray.*)'],
    /**
    * Method that composes the import statement from the constituent parts.
    *
    * @method _calculateImportCode
    * @param library
    * @param layer
    * @param base
    */
    _calculateImportCode: function(library,layer,base) {
      return '@import "' + library + '/_' + layer + '.' + base + '.scss";';
    },
    /**
    * Compares strings for dom-if logic.
    *
    * @method _isEqual
    * @param a
    * @param b
    */
    _isEqual: function(a, b) {
      return a === b;
    },
    /**
     * if the styleOptionsArray has a value run through each item, get the selectedValue, and assign it to selectedOptions
     */
    _updateSelectedOptions: function() {
      if (this.styleOptionsArray.length > 0) {
        // If we haven't already set our defaults, do it now. We only want to do so once.
        var i = 0,
            len = this.styleOptionsArray.length;
        for (i; i < len; i++) {
          var opt = this.styleOptionsArray[i];
          if (opt.type == "dropdown") {
            this.selectedOptions[opt.id] = opt.selectedValue;
          }
          if (opt.type == "toggle") {
            this.selectedOptions[opt.id] = opt.defaultValue;
          }
        };

        // Notify the world that we changed
        this.fire('px-sass-doc-viewer-selected-options-changed', this.selectedOptions);
      }
    }
  });
</script>
