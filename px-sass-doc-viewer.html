<!--
    Relative paths assume component is being run from inside an app or another component, where dependencies are flat
    siblings. When this component is run from its own repo (e.g. tests, examples), we assume the server is started with
    'gulp serve' (or similar server setup) to enable correct finding of bower dependencies for local runs.
-->
<link rel="import" href="../polymer/polymer.html"/>

<link rel="import" href="../px-clipboard/px-clipboard.html">
<link rel="import" href="../prism-element/prism-highlighter.html" />
<link rel="import" href="../px-dropdown/px-dropdown.html"/>
<link rel="import" href="../iron-ajax/iron-ajax.html"/>
<link rel="import" href="../polymer-font-awesome/polymer-font-awesome.html" />
<link rel="import" href="../iron-collapse/iron-collapse.html" />
<link rel="import" href="../iron-icon/iron-icon.html" />

<link rel="import" href="css/px-sass-doc-viewer-styles.html">
<link rel="import" href="px-highlighter.html" />

<!--
Element providing documentation for a requested Predix UI Sass component (design library).

##### Usage

      <px-sass-doc-viewer
        library-name="px-toggle-design"
        layer="objects"
        base-name="toggle"
        inuit-flags='["$inuit-enable-toggle--small","$inuit-enable-toggle--large","$inuit-enable-toggle--huge"]'
        usage-html='["<input id=\"toggle1\" class=\"toggle__input\" type=\"checkbox\">","<label for=\"toggle1\" class=\"toggle__label\"></label>"]'
        style-variables='["$inuit-toggle-color","$inuit-toggle-background","$inuit-toggle-border","$inuit-toggle-switch","$inuit-toggle-switch-border","$inuit-toggle-switch-shadow","$inuit-toggle-background--on","$inuit-toggle-border--on"]'
        dependencies='["https://github.com/PredixDev/px-colors-design","https://github.com/PredixDev/px-defaults-design","https://github.com/PredixDev/px-helpers-design"]'>
      </px-sass-doc-viewer>

@element px-sass-doc-viewer
@blurb Element providing documentation for a requested Predix UI Sass component (design library).
@homepage index.html
@demo index.html
-->

<dom-module id="px-sass-doc-viewer">
  <template>
    <style include="px-sass-doc-viewer-styles"></style>
    <style is="custom-style">
      .arrow--small {
        --iron-icon-height: 16px;
        --iron-icon-width: 16px;
      }
      .arrow--inactive {
        transform: rotate(-90deg);
      }
    </style>
    <prism-highlighter></prism-highlighter>
    <iron-ajax
        auto
        url="[[sassdocJsonPath]]"
        handle-as="json"
        last-response="{{_sassdocJson}}">
    </iron-ajax>

    <div class="apiContainer">
      <div class="flex flex--col api u-mt++">

        <!-- INSTALLATION -->
        <section class="u-mb++">
          <div class="componentHeader">Installation</div>
          <p>Install the module and any dependencies using Bower. Run this task from the command line inside your project folder:</p>
          <px-clipboard copy-from="#install">
            <figure class="code u-mr-">
              <code id="install">
                bower install --save {{libraryName}}
              </code>
            </figure>
          </px-clipboard>
        </section>

        <section class="u-mb++">
          <!-- IMPORT -->
          <div class="componentHeader">Enable and Import</div>
          <h3>Enable Flags</h3>
          <template is="dom-if" if="[[_has(inuitFlags)]]">
            <p>The following flags can be enabled to generate additional styles for the module. To use these styles, set the flags to true <strong>above the module @import statement</strong> in your project Sass file:</p>
          </template>
          <template is="dom-if" if="[[_has(inuitFlags)]]">
            <px-clipboard copy-from="#enable">
              <figure class="code u-mr-">
                <code id="install">
                  <template is="dom-repeat" items="{{inuitFlags}}">
                    {{item}} : true;<br/>
                  </template>
                </code>
              </figure>
            </px-clipboard>
          </template>
          <template is="dom-if" if="[[!_has(_sassdocInuitFlags)]]">
            <ul class="list-ui list-ui--large u-m++">
              <template is="dom-repeat" items="{{_sassdocInuitFlags}}">
                <li class="list-ui__item">
                  <h4>
                    <a on-tap="_toggle"><iron-icon class="arrow--small arrow--inactive" icon="fa:fa-angle-down" data-toggle="{{item.context.name}}"></iron-icon></a>
                    ${{item.context.name}}
                    <small class="caps muted weight--light u-ml">Type: {{item.type}}</small>
                    <small class="caps muted weight--light u-ml">Default Value: {{item.context.value}}</small>
                  </h4>
                  <iron-collapse id="{{item.context.name}}-container" no-animation>
                    <p class="u-mt++">{{item.description}}</p>
                    <px-clipboard copy-from="#{{item.context.name}}-code">
                      <figure class="code u-mr-">
                        <code id="{{item.context.name}}-code">
                          ${{item.context.name}} : true;
                        </code>
                      </figure>
                    </px-clipboard>
                  </iron-collapse>
                </li>
              </template>
            </ul>
          </template>
          <template is="dom-if" if="[[!_has(inuitFlags)]]">
            <p>There are no flags to set before importing this module in your project Sass file.</p>
          </template>

          <!-- INCLUDE -->
          <h3>Import Sass</h3>
          <p>Import the module by placing this code into the <strong>{{layer}}</strong> layer of your project Sass file: <a href="https://github.com/PredixDev/px-getting-started#import-order" target="_blank"><iron-icon icon="fa:fa-question-circle" class="u-mh--"></iron-icon>What's this?</a></p>
          <px-clipboard copy-from="#import2">
            <figure class="code u-mr-">
              <code id="import2">
                {{_importCode}}
              </code>
            </figure>
          </px-clipboard>
        </section>

        <!-- USAGE -->
        <section class="u-mb++">
          <div class="componentHeader">Usage</div>
          <p>Include the following HTML in your project to use the module:</p>
          <px-clipboard copy-from="#usageHTML">
            <px-highlighter highlight-target="#usageHTML">
              <content select="[data-slot=usageHTML]"></content>
            </px-highlighter>
            <pre class="code u-mr- u-mb">
              <code id="usageHTML" class="import-code"></code>
            </pre>
          </px-clipboard>
        </section>

        <!-- CUSTOMIZATION -->
        <template is="dom-if" if="[[_has(styleVariables)]]">
          <div class="componentHeader">Customization</div>
          <p>The following variables are available to customize the style of this element:</p>
        </template>
        <template is="dom-if" if="[[_has(styleVariables)]]">
          <section class="u-mb++">
            <px-clipboard copy-from="#customize">
              <figure class="code u-mr-">
                <code id="customize">
                  <template is="dom-repeat" items="{{styleVariables}}">
                    {{item}} <br/>
                  </template>
                </code>
              </figure>
            </px-clipboard>
          </section>
        </template>
        <template is="dom-if" if="[[_has(_sassdocStyleVariables)]]">
          <ul class="list-ui list-ui--large u-m++">
            <template is="dom-repeat" items="{{_sassdocStyleVariables}}">
              <li class="list-ui__item">
                <h4>
                  <a on-tap="_toggle"><iron-icon class="arrow--small arrow--inactive" icon="fa:fa-angle-down" data-toggle="{{item.context.name}}"></iron-icon></a>
                  ${{item.context.name}}
                  <small class="caps muted weight--light u-ml">Type: {{item.type}}</small>
                  <small class="caps muted weight--light u-ml">Default Value: {{item.context.value}}</small>
                </h4>
                <iron-collapse id="{{item.context.name}}-container" no-animation>
                  <p class="u-mt++">{{item.description}}</p>
                  <px-clipboard copy-from="#{{item.context.name}}-code">
                    <figure class="code u-mr-">
                      <code id="{{item.context.name}}-code">
                        ${{item.context.name}} : {{item.context.value}};
                      </code>
                    </figure>
                  </px-clipboard>
                </iron-collapse>
              </li>
            </template>
          </ul>
        </template>

        <!-- DEPENDENCIES -->
        <section class="u-mb++">
          <div class="componentHeader">Dependencies</div>
          <template is="dom-if" if="[[_has(dependencies)]]">
            <p>This module depends on the following modules (automatically included with Bower install):
              <ul>
                <template is="dom-repeat" items="{{dependencies}}">
                  <li><a class="actionable" href="{{item}}" target="_blank">{{item}}</a></li>
                </template>
              </ul>
            </p>
          </template>
          <template is="dom-if" if="[[!_has(dependencies)]]">
            <p>This module doesn't have any dependencies.</p>
          </template>
        </section>

      </div>
    </div>

  </template>
</dom-module>

<script>
  Polymer({

    is: 'px-sass-doc-viewer',

    /**
     * Properties block, expose attribute values to the DOM via 'notify'
     *
     * @property properties
     * @type Object
     */
    properties: {
      /**
      * Name of the overall sass repository.
      *
      * @property libraryName
      * @type String
      **/
      libraryName: {
        type: String,
        value: ''
      },
      /**
      * Inuit flags that are used to enable features and functionality, represented as an array of strings, which will display with line breaks between each.
      *
      * @property inuitFlags
      * @type Array
      */
      inuitFlags: {
        type: Array,
        value: function() { return []; }
      },
      /**
      * PRIVATE. Is true if intuitFlags and _sassdocInuitFlags aren't empty.
      *
      * @property _hasIntuitFlags
      * @type boolean
      */
      _hasIntuitFlags: {
        type: Boolean,
        value: false,
        computed: '_hasSome(inuitFlags)'
      },
      /**
      *  ITCSS layer that this component belongs in, e.g. generic, objects, trumps, etc.
      *
      * @property layer
      * @type String
      */
      layer: {
        type: String,
        value: ''
      },
      /**
      * Base name of the component in the file path, e.g. _objects.BASENAME.scss.
      *
      * @property baseName
      * @type String
      */
      baseName: {
        type: String,
        value: ''
      },
      /**
      * The HTML code snippet to actually use the component, represented as an array of strings. A newline will appear between each string in the array. Include an empty string to result in an extra line break.
      *
      * @property usageHtml
      * @type Array
      */
      usageHtml: {
        type: Array,
        value: function() { return []; }
      },
      /**
      * The SASS variables available for customizing the appearance of the component, represented as an array of strings, which will display with line breaks between each.
      *
      * @property styleVariables
      * @type Array
      */
      styleVariables: {
        type: Array,
        value: function() { return []; }
      },
      _hasStyleVariables: {
        type: Boolean,
        value: false,
        computed: '_hasSome(styleVariables)'
      },
      /**
      * Any dependencies that exist for this component, represented as an array of strings, which will display in a list. Each string item should be the fully qualified URL of the repo.
      *
      * @property dependencies
      * @type Array
      */
      dependencies: {
        type: Array,
        value: function() { return []; }
      },
      /**
      * PRIVATE. Is true if dependencies isn't empty.
      *
      * @property _hasDependencies
      * @type boolean
      */
      _hasDependencies: {
        type: Boolean,
        value: false,
        computed: '_hasSome(dependencies)'
      },
      /**
      * Composed string that represents the import statement of the sass component.
      *
      * @property _importCode
      * @type String
      */
      _importCode: {
        type: String,
        computed: '_calculateImportCode(libraryName,layer,baseName)'
      },
      sassdocJsonPath: {
        type: String
      },
      _sassdocJson: {
        type: Array,
        value: function(){ []; }
      },
      _sassdocStyleVariables: {
        type: Array,
        value: function(){ []; },
        computed: '_computeSassdocStyleVariables(_sassdocJson)'
      },
      _hasSassdocStyleVariables: {
        type: Boolean,
        value: false,
        computed: '_hasSome(_sassdocStyleVariables)'
      },
      _sassdocInuitFlags: {
        type: Array,
        value: function(){ []; },
        computed: '_computeSassdocIntuitFlags(_sassdocJson)'
      },
      _hasSassdocIntuitFlags: {
        type: Boolean,
        value: false,
        computed: '_hasSome(_sassdocInuitFlags)'
      },
      _hasFlags: {
        type: Boolean,
        value: false
      },
      _hasStyles: {
        type: Boolean,
        value: false
      },
    },
    observers: [
      '_computeHasFlags(intuitFlags)', '_computeHasFlags(_sassdocInuitFlags)',
      '_computeHasStyles(styleVariables)', '_computeHasStyles(_sassdocStyleVariables)'
    ],
    _has: function(thing) {
      return thing.length > 0;
    },
    _computeHasFlags: function() {
      this._hasFlags = this._hasSome(this.intuitFlags) || this._hasSome(this._sassdocInuitFlags);
    },
    _computeHasStyles: function() {
      this._hasStyles = this._hasSome(this.styleVariables) || this._hasSome(this._sassdocStyleVariables);
    },
    _computeSassdocStyleVariables: function() {
      return this._sassdocJson.filter(function(docItem){
        return docItem.group && docItem.group.indexOf('px-toggle-design:variables:style') > -1;
      });
    },
    _computeSassdocIntuitFlags: function() {
      return this._sassdocJson.filter(function(docItem){
        return docItem.group && docItem.group.indexOf('px-toggle-design:variables:flag') > -1;
      });
    },
    /**
    * Method that composes the import statement from the constituent parts.
    *
    * @method _calculateImportCode
    * @param library
    * @param layer
    * @param base
    */
    _calculateImportCode: function(library,layer,base) {
      return '@import "' + library + '/_' + layer + '.' + base + '.scss";';
    },
    /**
    * Method that determines if this element has a property or method with the
    * key provided, and checks if the value of that key has a length.
    *
    * @method _hasSome
    * @param {String} thing - a string representing the key of the property or method
    * @return {Boolean}
    */
    _hasSome: function(arr) {
      arr = arr || [];
      return arr.length > 0;
    },
    _toggle: function(evt) {
      var source = evt.target,
          target = '#' + evt.target.dataToggle + '-container';
      this.$$(target).toggle();
      this._toggleArrow(source);
    },
    _toggleArrow: function(el) {
      el.classList.toggle('arrow--inactive');
    }
  });
</script>
